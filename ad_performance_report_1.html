<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç´…é–€_ æ¯æ—¥å»£å‘Šç›£æ§å„€è¡¨æ¿</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Microsoft JhengHei', sans-serif; background: #f5f7fa; color: #333; }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; text-align: center; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .header h1 { font-size: 2em; margin-bottom: 5px; }
        .header .date { font-size: 1.1em; opacity: 0.9; }
        .alert-banner { background: #f39c12; color: white; padding: 10px; text-align: center; font-weight: bold; animation: pulse 2s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.7; } 100% { opacity: 1; } }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        .kpi-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 30px; }
        .kpi-card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); text-align: center; position: relative; overflow: hidden; }
        .kpi-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 4px; background: var(--accent-color); }
        .kpi-value { font-size: 1.8em; font-weight: bold; margin-bottom: 5px; color: var(--accent-color); }
        .kpi-label { color: #666; font-size: 0.9em; margin-bottom: 5px; }
        .kpi-change { display: inline-block; font-size: 0.8em; padding: 3px 8px; border-radius: 15px; font-weight: bold; margin-top: 5px; }
        .trend-up { background: #d4edda; color: #155724; }
        .trend-down { background: #f8d7da; color: #721c24; }
        .trend-stable { background: #e2e3e5; color: #383d41; }
        .primary { --accent-color: #3498db; } .success { --accent-color: #27ae60; } .warning { --accent-color: #f39c12; } .danger { --accent-color: #e74c3c; } .info { --accent-color: #17a2b8; }
        .charts-section { display: grid; grid-template-columns: 2fr 1fr; gap: 20px; margin-bottom: 30px; }
        .chart-card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .chart-title { font-size: 1.3em; font-weight: 600; margin-bottom: 15px; color: #2c3e50; display: flex; align-items: center; gap: 10px; }
        .chart-wrapper { position: relative; height: 300px; }
        .alert-section { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .alert-item { display: flex; align-items: center; padding: 10px; margin-bottom: 10px; border-left: 4px solid; border-radius: 4px; }
        .alert-critical { background: #f8d7da; border-color: #dc3545; color: #721c24; }
        .alert-warning { background: #fff3cd; border-color: #ffc107; color: #856404; }
        .alert-success { background: #d1e7dd; border-color: #198754; color: #0f5132; }
        .insights-card { background: white; padding: 20px 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .insights-card h2 { font-size: 1.3em; font-weight: 600; margin-bottom: 15px; color: #2c3e50; display: flex; align-items: center; gap: 10px; }
        .insights-card ul, .insights-card ol { padding-left: 20px; }
        .insights-card li { margin-bottom: 12px; line-height: 1.7; }
        .campaign-performance { background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .campaign-table { width: 100%; border-collapse: collapse; }
        .campaign-table th, .campaign-table td { padding: 12px 15px; text-align: left; border-bottom: 1px solid #f1f3f4; }
        .campaign-table th { background: #f8f9fa; font-weight: 600; color: #495057; font-size: 0.9em; }
        .campaign-table tbody tr:hover { background: #f8f9fa; }
        .comparison-cell { font-size: 0.8em; opacity: 0.8; }
        @media (max-width: 992px) { .charts-section { grid-template-columns: 1fr; } }
        @media (max-width: 768px) { .kpi-grid { grid-template-columns: repeat(2, 1fr); } }
    </style>
</head>
<body>
    <div id="alert-banner-container"></div>
    <div class="header">
        <h1>ğŸ“Š ç´…é–€_ æ¯æ—¥å»£å‘Šç›£æ§</h1>
        <div class="date" id="report-date"></div>
    </div>
    
    <div class="container">
        <div style="background: #e8f5e8; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #27ae60;">
            <strong>ğŸ“Š æ•¸æ“šä¾†æºï¼š</strong> æœ¬å ±è¡¨ä½¿ç”¨Meta MCPå·¥å…·ç›´æ¥å¾Facebook Graph APIç²å–çš„å»£å‘Šæ•¸æ“š
            <br><strong id="data-range-info">ğŸ“… æ•¸æ“šç¯„åœï¼š</strong>
        </div>
        
        <div id="kpi-grid-container" class="kpi-grid"></div>
        
        <div class="charts-section">
            <div class="chart-card">
                <div class="chart-title">ğŸ“ˆ è¿‘7æ—¥è¶¨å‹¢è¿½è¹¤</div>
                <div class="chart-wrapper"><canvas id="trendChart"></canvas></div>
            </div>
            <div class="chart-card">
                <div class="chart-title">ğŸ¯ ä»Šæ—¥å„æ´»å‹•èŠ±è²»åˆ†å¸ƒ</div>
                <div class="chart-wrapper"><canvas id="spendDistributionChart"></canvas></div>
            </div>
        </div>
        
        <div id="alert-section-container" class="alert-section"></div>
        
        <!-- Insights and Recommendations -->
        <div class="insights-card">
            <h2>ğŸš€ é—œéµæ´è¦‹</h2>
            <ul id="insights-list">
                <!-- Insights will be dynamically inserted here -->
            </ul>
        </div>
        <div class="insights-card">
            <h2>ğŸ’¡ å»ºè­°æ¡å–çš„è¡Œå‹•</h2>
            <ol id="recommendations-list">
                <!-- Recommendations will be dynamically inserted here -->
            </ol>
        </div>

        <div class="campaign-performance">
            <div class="chart-title" style="padding: 15px 20px; border-bottom: 1px solid #dee2e6;">ğŸ“‹ æ´»å‹•å³æ™‚ç‹€æ…‹</div>
            <div style="overflow-x: auto;">
                <table class="campaign-table">
                    <thead>
                        <tr>
                            <th>æ´»å‹•åç¨±</th>
                            <th>ä»Šæ—¥èŠ±è²» (TWD)</th>
                            <th>ä»Šæ—¥è³¼è²·æ•¸</th>
                            <th>ä»Šæ—¥CPA (TWD)</th>
                            <th>ä»Šæ—¥CTR (%)</th>
                            <th>ä»Šæ—¥CPC (TWD)</th>
                        </tr>
                    </thead>
                    <tbody id="campaign-table-body"></tbody>
                </table>
            </div>
        </div>
    </div>
    
    <script>
    const reportDate = "2025-09-22";
    const data = {
        "2025-09-22": {
            "summary": { "spend": 2810, "impressions": 29121, "clicks": 1014, "purchases": 176 },
            "campaigns": [
                { "name": "è½‰æ›ï½œæ–°èˆŠå®¢ï½œå¸¸æ…‹ï½œå½Œæœˆ", "spend": 204, "impressions": 2342, "clicks": 93, "purchases": 6 },
                { "name": "è½‰æ›ï½œæ–°èˆŠå®¢ï½œQé¤…", "spend": 580, "impressions": 5986, "clicks": 220, "purchases": 20 },
                { "name": "è½‰æ›ï½œæ–°èˆŠå®¢ï½œä¸­ç§‹ç¯€", "spend": 1576, "impressions": 16357, "clicks": 582, "purchases": 108 },
                { "name": "è½‰æ›ï½œç¶²ç´…é–‹åœ˜ï½œä¸­ç§‹ç¯€", "spend": 450, "impressions": 4436, "clicks": 119, "purchases": 38 }
            ]
        },
        "2025-09-21": {
            "summary": { "spend": 2648, "impressions": 26246, "clicks": 1030, "purchases": 155 },
            "campaigns": [
                { "name": "è½‰æ›ï½œæ–°èˆŠå®¢ï½œå¸¸æ…‹ï½œå½Œæœˆ", "spend": 202, "impressions": 2654, "clicks": 120, "purchases": 5 },
                { "name": "è½‰æ›ï½œæ–°èˆŠå®¢ï½œQé¤…", "spend": 540, "impressions": 5641, "clicks": 224, "purchases": 26 },
                { "name": "è½‰æ›ï½œæ–°èˆŠå®¢ï½œä¸­ç§‹ç¯€", "spend": 1504, "impressions": 14260, "clicks": 606, "purchases": 110 },
                { "name": "è½‰æ›ï½œç¶²ç´…é–‹åœ˜ï½œä¸­ç§‹ç¯€", "spend": 402, "impressions": 3691, "clicks": 80, "purchases": 15 }
            ]
        },
        "2025-09-15": {
            "summary": { "spend": 15078, "impressions": 122228, "clicks": 4360, "purchases": 404 },
            "campaigns": [
                { "name": "è½‰æ›ï½œæ–°èˆŠå®¢ï½œå¸¸æ…‹ï½œå½Œæœˆ", "spend": 192, "impressions": 1880, "clicks": 83, "purchases": 4 },
                { "name": "è½‰æ›ï½œæ–°èˆŠå®¢ï½œQé¤…", "spend": 530, "impressions": 5013, "clicks": 143, "purchases": 0 },
                { "name": "è½‰æ›ï½œæ–°èˆŠå®¢ï½œä¸­ç§‹ç¯€", "spend": 12610, "impressions": 97124, "clicks": 2765, "purchases": 353 },
                { "name": "è½‰æ›ï½œæ–°èˆŠå®¢ï½œæ¸¯æ¾³ä¸­ç§‹ç¯€", "spend": 350, "impressions": 2341, "clicks": 101, "purchases": 1 },
                { "name": "è½‰æ›ï½œç¶²ç´…é–‹åœ˜ï½œä¸­ç§‹ç¯€", "spend": 996, "impressions": 8908, "clicks": 646, "purchases": 47 }
            ]
        },
        "trendData": [
            { "date": "2025-09-16", "spend": 15681, "cpa": 32.3 },
            { "date": "2025-09-17", "spend": 5736, "cpa": 27.8 },
            { "date": "2025-09-18", "spend": 3584, "cpa": 21.3 },
            { "date": "2025-09-19", "spend": 3381, "cpa": 21.1 },
            { "date": "2025-09-20", "spend": 2462, "cpa": 20.3 },
            { "date": "2025-09-21", "spend": 2648, "cpa": 17.1 },
            { "date": "2025-09-22", "spend": 2810, "cpa": 16.0 }
        ]
    };

    document.addEventListener('DOMContentLoaded', function() {
        // --- UTILITY FUNCTIONS ---
        const formatCurrency = (value) => `TWD $${Math.round(value).toLocaleString()}`;
        const formatNumber = (value) => Math.round(value).toLocaleString();
        const formatPercent = (value) => `${(value * 100).toFixed(2)}%`;
        const calculateChange = (current, previous) => previous ? (current - previous) / previous : Infinity;
        const getCPA = (spend, purchases) => purchases > 0 ? spend / purchases : 0;
        const getCTR = (clicks, impressions) => impressions > 0 ? clicks / impressions : 0;
        const getCPC = (spend, clicks) => clicks > 0 ? spend / clicks : 0;

        function getChangeHtml(change, isCost = false) {
            if (change === Infinity || !isFinite(change)) return `<div class="kpi-change trend-stable">N/A</div>`;
            
            let isUp = change > 0;
            // For cost metrics like CPA, an increase is bad (down), a decrease is good (up).
            if (isCost) isUp = change < 0;

            const trendClass = isUp ? 'trend-up' : 'trend-down';
            const sign = change > 0 ? 'â–²' : 'â–¼';
            return `<div class="kpi-change ${trendClass}">${sign} ${Math.abs(change * 100).toFixed(1)}%</div>`;
        }

        // --- DATA PROCESSING ---
        const today = data[reportDate].summary;
        const yesterday = data["2025-09-21"].summary;
        const lastWeek = data["2025-09-15"].summary;

        today.cpa = getCPA(today.spend, today.purchases);
        yesterday.cpa = getCPA(yesterday.spend, yesterday.purchases);
        lastWeek.cpa = getCPA(lastWeek.spend, lastWeek.purchases);
        today.ctr = getCTR(today.clicks, today.impressions);
        yesterday.ctr = getCTR(yesterday.clicks, yesterday.impressions);
        lastWeek.ctr = getCTR(lastWeek.clicks, lastWeek.impressions);
        today.cpc = getCPC(today.spend, today.clicks);
        yesterday.cpc = getCPC(yesterday.spend, yesterday.clicks);
        lastWeek.cpc = getCPC(lastWeek.cpc, lastWeek.clicks);

        const kpis = [
            { id: 'spend', label: 'ä»Šæ—¥èŠ±è²»', value: formatCurrency(today.spend), color: 'primary', dod: calculateChange(today.spend, yesterday.spend), wow: calculateChange(today.spend, lastWeek.spend) },
            { id: 'purchases', label: 'ä»Šæ—¥è³¼è²·æ•¸', value: formatNumber(today.purchases), color: 'success', dod: calculateChange(today.purchases, yesterday.purchases), wow: calculateChange(today.purchases, lastWeek.purchases) },
            { id: 'cpa', label: 'ä»Šæ—¥CPA', value: formatCurrency(today.cpa), color: 'danger', dod: calculateChange(today.cpa, yesterday.cpa), wow: calculateChange(today.cpa, lastWeek.cpa), isCost: true },
            { id: 'ctr', label: 'ä»Šæ—¥CTR', value: formatPercent(today.ctr), color: 'warning', dod: calculateChange(today.ctr, yesterday.ctr), wow: calculateChange(today.ctr, lastWeek.ctr) },
            { id: 'clicks', label: 'ä»Šæ—¥é»æ“Š', value: formatNumber(today.clicks), color: 'info', dod: calculateChange(today.clicks, yesterday.clicks), wow: calculateChange(today.clicks, lastWeek.clicks) },
        ];
        
        // --- RENDER FUNCTIONS ---
        function renderHeader() {
            document.getElementById('report-date').innerText = `${reportDate} | æ•¸æ“šæ›´æ–°æ™‚é–“ï¼šå³æ™‚ (Meta API)`;
            document.getElementById('data-range-info').innerHTML += `${reportDate} ç•¶æ—¥æ•¸æ“š vs 2025-09-21 å°æ¯” | vs 2025-09-15 å°æ¯”`;
        }

        function renderKpis() {
            const container = document.getElementById('kpi-grid-container');
            container.innerHTML = kpis.map(kpi => `
                <div class="kpi-card ${kpi.color}">
                    <div class="kpi-value">${kpi.value}</div>
                    <div class="kpi-label">${kpi.label}</div>
                    ${getChangeHtml(kpi.dod, kpi.isCost)} vs æ˜¨æ—¥
                    ${getChangeHtml(kpi.wow, kpi.isCost)} vs ä¸Šé€±åŒæ—¥
                </div>
            `).join('');
        }

        function renderAlerts() {
            const alerts = [];
            const cpaChangeDoD = calculateChange(today.cpa, yesterday.cpa);
            if (cpaChangeDoD > 0.2) alerts.push({ type: 'critical', text: `<strong>ç·Šæ€¥ï¼š</strong>æ•´é«”CPAè¼ƒæ˜¨æ—¥ä¸Šå‡ ${(cpaChangeDoD*100).toFixed(1)}%ï¼Œéœ€ç«‹å³æª¢è¦–ã€‚` });
            else if (cpaChangeDoD < -0.2) alerts.push({ type: 'success', text: `<strong>è‰¯å¥½ï¼š</strong>æ•´é«”CPAè¼ƒæ˜¨æ—¥ä¸‹é™ ${Math.abs(cpaChangeDoD*100).toFixed(1)}%ï¼Œæˆæœ¬æ•ˆç›Šæå‡ã€‚` });

            const ctrChangeDoD = calculateChange(today.ctr, yesterday.ctr);
             if (ctrChangeDoD < -0.1) alerts.push({ type: 'warning', text: `<strong>æ³¨æ„ï¼š</strong>æ•´é«”CTRè¼ƒæ˜¨æ—¥ä¸‹é™ ${Math.abs(ctrChangeDoD*100).toFixed(1)}%ï¼Œç´ æå¸å¼•åŠ›å¯èƒ½é™ä½ã€‚` });

            const topCampaign = data[reportDate].campaigns.reduce((prev, current) => (prev.spend > current.spend) ? prev : current);
            alerts.push({ type: 'warning', text: `<strong>è§€å¯Ÿï¼š</strong>ã€Œ${topCampaign.name}ã€æ˜¯ä»Šæ—¥æœ€ä¸»è¦çš„æ¶ˆè²»æ´»å‹•ï¼Œä½”ç¸½é ç®—çš„ ${(topCampaign.spend/today.spend*100).toFixed(1)}%ã€‚` });
            
            const bannerAlert = alerts.find(a => a.type === 'critical' || a.type === 'warning');
            if(bannerAlert) {
                document.getElementById('alert-banner-container').innerHTML = `<div class="alert-banner">ğŸš¨ ${bannerAlert.text.replace(/<strong>.*?<\/strong>/g, '')}</div>`;
            }

            const container = document.getElementById('alert-section-container');
            container.innerHTML = `<div class="chart-title">ğŸš¨ å³æ™‚é è­¦</div>` + alerts.map(alert => `
                <div class="alert-item alert-${alert.type}">${alert.text}</div>
            `).join('');

            // New Insights & Recommendations
            const insightsList = document.getElementById('insights-list');
            const recommendationsList = document.getElementById('recommendations-list');

            const insights = [
                `<strong>ğŸš€ æˆæœ¬æ•ˆç›ŠæŒçºŒå„ªåŒ–ï¼Œæˆæ•ˆç©©å®šå¢é•·</strong>ï¼šèˆ‡æ˜¨æ—¥ç›¸æ¯”ï¼Œä»Šæ—¥èŠ±è²»å¾®å¢ 6.1%ï¼Œä½†æˆåŠŸå¸¶ä¾†äº† 13.5% çš„è³¼è²·æ•¸å¢é•·ï¼Œä½¿å¾—<strong>å–®æ¬¡è³¼è²·æˆæœ¬ (CPA) é€²ä¸€æ­¥ä¸‹é™ 6.4%</strong>ï¼Œé”åˆ° TWD $16.0 çš„æ–°ä½é»ã€‚é€™é¡¯ç¤ºå¸³æˆ¶çš„æŠ•æ”¾æ•ˆç‡æ­£æŒçºŒæå‡ã€‚`,
                `<strong>ğŸ“ˆ ã€Œç¶²ç´…é–‹åœ˜ã€æ´»å‹•è¡¨ç¾äº®çœ¼</strong>ï¼š<code>è½‰æ›ï½œç¶²ç´…é–‹åœ˜ï½œä¸­ç§‹ç¯€</code> æ˜¯ä»Šæ—¥æˆæ•ˆæå‡çš„æœ€å¤§åŠŸè‡£ã€‚å…¶è³¼è²·æ•¸è¼ƒæ˜¨æ—¥<strong>æš´å¢ 153%</strong>ï¼Œè€Œ CPA æ›´æ˜¯<strong>å¤§å¹…é™ä½äº† 56%</strong>ï¼Œå¾ $26.8 é™è‡³ $11.8ï¼Œæˆæ•ˆå“è¶Šã€‚`,
                `<strong>âš ï¸ ã€ŒQé¤…ã€æ´»å‹•æˆæœ¬å‡ºç¾è­¦è¨Š</strong>ï¼š<code>è½‰æ›ï½œæ–°èˆŠå®¢ï½œQé¤…</code> æ´»å‹•çš„ CPA <strong>è¼ƒæ˜¨æ—¥ä¸Šæ¼²äº†è¿‘ 40%</strong>ï¼Œå¾ $20.8 å‡è‡³ $29.0ã€‚é›–ç„¶ä»åœ¨å¯æ¥å—ç¯„åœï¼Œä½†æˆæœ¬ä¸Šæšçš„è¶¨å‹¢éœ€è¦å¯†åˆ‡é—œæ³¨ã€‚`,
                `<strong>ğŸ“‰ æ•´é«”ç­–ç•¥è½‰å‹æˆåŠŸ</strong>ï¼šèˆ‡ä¸Šé€±åŒæ—¥ç›¸æ¯”ï¼Œç¸½èŠ±è²»å¤§å¹…æ¸›å°‘äº† 81.4%ï¼Œä½† CPA ä¹ŸæˆåŠŸ<strong>é™ä½äº† 57.1%</strong>ã€‚é€™å†æ¬¡é©—è­‰äº†å…ˆå‰ã€Œé—œé–‰èˆŠæ´»å‹•ã€å•Ÿç”¨æ–°ä¸»é¡Œå»£å‘Šã€çš„ç­–ç•¥èª¿æ•´æ˜¯æ¥µç‚ºæˆåŠŸçš„ï¼Œå¯¦ç¾äº†ç”¨æ›´å°‘é ç®—ç¶­æŒé«˜æ•ˆè½‰æ›çš„ç›®æ¨™ã€‚`
            ];

            const recommendations = [
                `<strong>æ”¾å¤§æˆåŠŸç¶“é©—</strong>ï¼šç«‹å³æ·±å…¥åˆ†æ <code>è½‰æ›ï½œç¶²ç´…é–‹åœ˜ï½œä¸­ç§‹ç¯€</code> æ´»å‹•ï¼Œæ‰¾å‡ºæ˜¯å“ªå€‹å»£å‘Šçµ„åˆ (Ad Set) æˆ–å»£å‘Šç´ æ (Ad Creative) å¸¶ä¾†äº†å¦‚æ­¤å·¨å¤§çš„æˆæ•ˆèºå‡ã€‚<strong>è€ƒæ…®é€æ­¥ç‚ºè©²æ´»å‹•æˆ–å…¶ä¸‹çš„æˆåŠŸçµ„åˆå¢åŠ é ç®—</strong>ï¼Œä»¥æ“´å¤§æˆ°æœã€‚`,
                `<strong>å„ªåŒ–æˆæœ¬ä¸Šæšçš„æ´»å‹•</strong>ï¼šé‡å° CPA æ˜é¡¯ä¸Šæ¼²çš„ <code>è½‰æ›ï½œæ–°èˆŠå®¢ï½œQé¤…</code> æ´»å‹•ï¼Œå»ºè­°<strong>æª¢æŸ¥å…¶å…§éƒ¨çš„å»£å‘Šçµ„åˆå’Œç´ ææˆæ•ˆ</strong>ã€‚æ˜¯å¦æœ‰é»æ“Šç‡ (CTR) ä¸‹é™æˆ–é »ç‡ (Frequency) éé«˜çš„æƒ…æ³ï¼Ÿå¯ä»¥è€ƒæ…®æš«åœå…¶ä¸­è¡¨ç¾ä¸ä½³çš„å»£å‘Šï¼Œæˆ–æ›´æ–°å»£å‘Šç´ æã€‚`,
                `<strong>ç¶­æŒä¸»åŠ›æ´»å‹•çš„ç©©å®š</strong>ï¼š<code>è½‰æ›ï½œæ–°èˆŠå®¢ï½œä¸­ç§‹ç¯€</code> æ˜¯ç›®å‰æœ€ä¸»è¦çš„æ¶ˆè²»ä¸»åŠ›ï¼Œæˆæ•ˆç©©å®šã€‚å»ºè­°<strong>ç¶­æŒç›®å‰çš„é ç®—å’Œè¨­å®š</strong>ï¼Œä¸¦æŒçºŒç›£æ§å…¶ CPA æ˜¯å¦ç©©å®šåœ¨ $15 ä»¥ä¸‹çš„å„ªç§€æ°´å¹³ã€‚`,
                `<strong>è¦åŠƒå¾ŒçºŒæª”æœŸç´ æ</strong>ï¼šä¸­ç§‹ç¯€æª”æœŸå³å°‡çµæŸï¼Œæ‡‰åŸºæ–¼é€™æ¬¡ã€Œæ™šé³¥ã€ä¸»é¡Œå»£å‘Šçš„æˆåŠŸç¶“é©—ï¼Œ<strong>æå‰è¦åŠƒä¸‹ä¸€æª”æœŸï¼ˆä¾‹å¦‚ï¼šé›™åç¯€ã€é›™åä¸€ï¼‰çš„å»£å‘Šç´ æèˆ‡å„ªæƒ æ´»å‹•</strong>ï¼Œä»¥è¤‡è£½æ­¤æ¬¡æˆåŠŸçš„æ¨¡å¼ã€‚`
            ];

            insightsList.innerHTML = insights.map(item => `<li>${item}</li>`).join('');
            recommendationsList.innerHTML = recommendations.map(item => `<li>${item}</li>`).join('');
        }
        
        function renderCampaignTable() {
            const container = document.getElementById('campaign-table-body');
            container.innerHTML = data[reportDate].campaigns.map(c => {
                const yesterdayCampaign = data['2025-09-21'].campaigns.find(yc => yc.name === c.name) || {};
                const lastWeekCampaign = data['2025-09-15'].campaigns.find(lwc => lwc.name === c.name) || {};

                const cpa = getCPA(c.spend, c.purchases);
                const ctr = getCTR(c.clicks, c.impressions);
                const cpc = getCPC(c.spend, c.clicks);
                
                const yesterdayCPA = getCPA(yesterdayCampaign.spend, yesterdayCampaign.purchases);
                const lastWeekCPA = getCPA(lastWeekCampaign.spend, lastWeekCampaign.purchases);
                
                return `
                    <tr>
                        <td>${c.name}</td>
                        <td>
                            ${formatCurrency(c.spend)}
                            <div class="comparison-cell">æ˜¨æ—¥: ${formatCurrency(yesterdayCampaign.spend || 0)} | ä¸Šé€±: ${formatCurrency(lastWeekCampaign.spend || 0)}</div>
                        </td>
                        <td>
                            ${formatNumber(c.purchases)}
                            <div class="comparison-cell">æ˜¨æ—¥: ${formatNumber(yesterdayCampaign.purchases || 0)} | ä¸Šé€±: ${formatNumber(lastWeekCampaign.purchases || 0)}</div>
                        </td>
                         <td>
                            ${formatCurrency(cpa)}
                            <div class="comparison-cell">æ˜¨æ—¥: ${formatCurrency(yesterdayCPA)} | ä¸Šé€±: ${formatCurrency(lastWeekCPA)}</div>
                        </td>
                        <td>${formatPercent(ctr)}</td>
                        <td>${formatCurrency(cpc)}</td>
                    </tr>
                `;
            }).join('');
        }

        function renderCharts() {
            // Trend Chart
            new Chart(document.getElementById('trendChart').getContext('2d'), {
                type: 'line',
                data: {
                    labels: data.trendData.map(d => d.date),
                    datasets: [
                        { label: 'èŠ±è²» (TWD)', data: data.trendData.map(d => d.spend), borderColor: '#3498db', yAxisID: 'y' },
                        { label: 'CPA (TWD)', data: data.trendData.map(d => d.cpa), borderColor: '#e74c3c', yAxisID: 'y1' }
                    ]
                },
                options: { responsive: true, maintainAspectRatio: false, interaction: { mode: 'index', intersect: false }, scales: { y: { position: 'left', title: { display: true, text: 'èŠ±è²» (TWD)' } }, y1: { position: 'right', title: { display: true, text: 'CPA (TWD)' }, grid: { drawOnChartArea: false } } } }
            });

            // Spend Distribution
            new Chart(document.getElementById('spendDistributionChart').getContext('2d'), {
                type: 'doughnut',
                data: {
                    labels: data[reportDate].campaigns.map(c => c.name),
                    datasets: [{
                        data: data[reportDate].campaigns.map(c => c.spend),
                        backgroundColor: ['#3498db', '#27ae60', '#f39c12', '#e74c3c', '#8e44ad'],
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom' } } }
            });
        }

        // --- INITIALIZE DASHBOARD ---
        renderHeader();
        renderKpis();
        renderAlerts();
        renderCampaignTable();
        renderCharts();
    });
    </script>
</body>
</html>
